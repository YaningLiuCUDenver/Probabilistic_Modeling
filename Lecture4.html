<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>4&nbsp; Limiting Probabilities for Markov Chains â€“ MATH 4792/5792 Probabilistic Modeling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Lecture5.html" rel="next">
<link href="./Lecture3.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Lecture4.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Limiting Probabilities for Markov Chains</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">MATH 4792/5792 Probabilistic Modeling</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Stochastic Processes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to Markov Chains</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Classification of States for Markov Chains</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture4.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Limiting Probabilities for Markov Chains</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Some Markov Chains Applications</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Time Reversible Markov Chains</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Hidden Markov Chains</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">The Exponential Distribution</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Further Properties of the Exponential Distribution</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">The Poisson Process</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Further Properties of Poisson Processes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Conditional Distribution of the Arrival Times</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Introduction to Continuous-Time Markov Chains</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture14.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Introduction to Queueing Theory</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture15.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Exponential Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture16.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Brownian Motion</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture17.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Variations on Brownian Motion and Pricing Stock Options</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture18.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Introduction to Monte Carlo Simulation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture19.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">General Techniques for Simulating Continuous Random Variables</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture20.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Special Techniques for Simulating Continuous Random Variables</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture21.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Simulating from Discrete Distributions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture22.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Simulating Stochastic Processes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture23.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Variance Reduction Techniques-Part I</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture24.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Variance Reduction Techniques-Part II</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Variance Reduction Techniques-Part III</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#limiting-probabilities" id="toc-limiting-probabilities" class="nav-link active" data-scroll-target="#limiting-probabilities"><span class="header-section-number">4.1</span> Limiting Probabilities</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Limiting Probabilities for Markov Chains</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="limiting-probabilities" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="limiting-probabilities"><span class="header-section-number">4.1</span> Limiting Probabilities</h2>
<p>In Example 4 in Lecture 2, where we considered a two-state Markov chain with one-step transition probability given by <span class="math display">\[
P =
\begin{bmatrix}
0.7 &amp; 0.3 \\
0.4 &amp; 0.6
\end{bmatrix},
\]</span> we calculated <span class="math inline">\(P^{(4)}\)</span>, which is <span class="math display">\[
P^{(4)} =
\begin{bmatrix}
0.5749 &amp; 0.4251 \\
0.5668 &amp; 0.4332
\end{bmatrix}.
\]</span> From this, it follows that <span class="math inline">\(P^{(8)}=P^{(4)}\cdot P^{(4)}\)</span> is given (to three significant places) by <span class="math display">\[
P^{(8)} =
\begin{bmatrix}
0.572 &amp; 0.428 \\
0.570 &amp; 0.430
\end{bmatrix}
\]</span></p>
<p>Note that the matrix <span class="math inline">\(P^{(8)}\)</span> is almost identical to the matrix <span class="math inline">\(P^{(4)}\)</span>, and secondly, that each of the rows of <span class="math inline">\(P^{(8)}\)</span> has almost identical entries. In fact it seems that <span class="math inline">\(P^n_{ij}\)</span> is converging to some value (as <span class="math inline">\(n\rightarrow\infty\)</span>) which is the same for all <span class="math inline">\(i\)</span>. In other words, there seems to exist a limiting probability that the process will be in state <span class="math inline">\(j\)</span> after a large number of transitions, and this value is independent of the initial state.</p>
<p>To make the preceding heuristics more precise, two additional properties of the states of a Markov chain need to be considered. State <span class="math inline">\(i\)</span> is said to have <strong>period</strong> <span class="math inline">\(d\)</span> if <span class="math inline">\(P^n_{ii}= 0\)</span> whenever <span class="math inline">\(n\)</span> is not divisible by <span class="math inline">\(d\)</span>, and <span class="math inline">\(d\)</span> is the largest integer with this property. For instance, starting in <span class="math inline">\(i\)</span>, it may be possible for the process to enter state <span class="math inline">\(i\)</span> only at the times <span class="math inline">\(2, 4, 6, 8, \cdots\)</span>, in which case state <span class="math inline">\(i\)</span> has period 2. A state with period 1 is said to be <strong>aperiodic</strong>. It can be shown that periodicity is a class property. That is, if state <span class="math inline">\(i\)</span> has period <span class="math inline">\(d\)</span>, and states <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> communicate, then state <span class="math inline">\(j\)</span> also has period <span class="math inline">\(d\)</span>.</p>
<p>If state <span class="math inline">\(i\)</span> is recurrent, then it is said to be <strong>positive recurrent</strong> if, starting in <span class="math inline">\(i\)</span>, the expected time until the process returns to state <span class="math inline">\(i\)</span> is finite. It can be shown that positive recurrence is a class property. While there exist recurrent states that are not positive recurrent (such states are called <strong>null recurrent</strong>), it can be shown that in a finite-state Markov chain all recurrent states are positive recurrent. Positive recurrent, aperiodic states are called <strong>ergodic</strong>.</p>
<p>We are now ready for the following important theorem which we state without proof.</p>
<div id="thm-thm1" class="theorem">
<p><span class="theorem-title"><strong>Theorem 4.1</strong></span> For an irreducible ergodic Markov chain <span class="math inline">\(\lim_{n\rightarrow\infty} P^n_{ij}\)</span> exists and is independent of <span class="math inline">\(i\)</span>. Furthermore, letting <span class="math display">\[
\pi_j = \lim_{n\rightarrow\infty}P^n_{ij}, \quad j\ge 0
\]</span> then <span class="math inline">\(\pi_j\)</span> is the unique nonnegative solution of <span class="math display">\[
\pi_j = \sum_{i=0}^{\infty}\pi_i P_{ij},\quad j\ge 0,
\]</span> <span id="eq-eq4-7"><span class="math display">\[
\sum_{j=0}^\infty \pi_j = 1
\tag{4.1}\]</span></span></p>
</div>
<div id="rem-rem1" class="proof remark">
<p><span class="proof-title"><em>Remark 4.1</em>. </span></p>
<ol type="i">
<li><p>Given that <span class="math inline">\(\pi_j = \lim_{n\rightarrow\infty}P^n_{ij}\)</span> exists and is independent of the initial state <span class="math inline">\(i\)</span>, it is not difficult to (heuristically) see that the <span class="math inline">\(\pi\)</span>â€™s must satisfy <a href="#eq-eq4-7" class="quarto-xref">Equation&nbsp;<span>4.1</span></a>. Let us derive an expression for <span class="math inline">\(P\{X_{n+1} = j\}\)</span> by conditioning on the state at time <span class="math inline">\(n\)</span>. That is, <span class="math display">\[
P\{X_{n+1}=j\} = \sum_{i=0}^\infty P\{X_{n+1}=j | X_n = i\} P\{X_{n}=i\} = \sum_{i=0}^\infty P_{ij}P\{X_{n} = i\}
\]</span> Letting <span class="math inline">\(n\rightarrow\infty\)</span>, and assuming that we can bring the limit inside the summation, leads to <span class="math display">\[
\pi_j = \sum_{i=0}^\infty P_{ij}\pi_i
\]</span></p></li>
<li><p>It can be shown that <span class="math inline">\(\pi_j\)</span> , the limiting probability that the process will be in state <span class="math inline">\(j\)</span> at time <span class="math inline">\(n\)</span>, also equals the long-run proportion of time that the process will be in state <span class="math inline">\(j\)</span> .</p></li>
<li><p>If the Markov chain is irreducible, then there will be a solution to <span class="math display">\[
\pi_j = \sum_{i}\pi_i P_{ij},\quad j\ge 0,
\]</span> <span class="math display">\[
\sum_{j} \pi_j = 1
\]</span> if and only if the Markov chain is positive recurrent. If a solution exists then it will be unique, and <span class="math inline">\(\pi_j\)</span> will equal the long run proportion of time that the Markov chain is in state <span class="math inline">\(j\)</span> . If the chain is aperiodic, then <span class="math inline">\(\pi_j\)</span> is also the limiting probability that the chain is in state <span class="math inline">\(j\)</span>.</p></li>
</ol>
</div>
<div id="exm-exa1" class="theorem example">
<p><span class="theorem-title"><strong>Example 4.1</strong></span> Consider Example 1 in Lecture 2, in which we assume that if it rains today, then it will rain tomorrow with probability <span class="math inline">\(\alpha\)</span>; and if it does not rain today, then it will rain tomorrow with probability <span class="math inline">\(\beta\)</span>. If we say that the state is <span class="math inline">\(0\)</span> when it rains and <span class="math inline">\(1\)</span> when it does not rain, then by <a href="#eq-eq4-7" class="quarto-xref">Equation&nbsp;<span>4.1</span></a> the limiting probabilities <span class="math inline">\(\pi_0\)</span> and <span class="math inline">\(\pi_1\)</span> are given by <span class="math display">\[
\begin{aligned}
\pi_0 &amp;= \alpha\pi_0 + \beta\pi_1 \\
\pi_1 &amp;= (1-\alpha)\pi_0 + (1-\beta)\pi_1 \\
\pi_0 + \pi_1 &amp;= 1
\end{aligned}
\]</span> which yields that <span class="math display">\[
\pi_0 = \frac{\beta}{1+\beta-\alpha}, \quad \pi_1 = \frac{1-\alpha}{1+\beta-\alpha}
\]</span> For example if <span class="math inline">\(\alpha = 0.7\)</span> and <span class="math inline">\(\beta = 0.4\)</span>, then the limiting probability of rain is <span class="math inline">\(\pi_0 = \frac{4}{7} = 0.571\)</span>.</p>
</div>
<div id="606a57a2" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> simulate_rain(P, n):</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Simulate the rain problem</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">    input:</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">    P: numpy 2d array of shape (2,2), the transition probability matrix</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">    n: int, number of steps to simulate</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">    output:</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co">    state: int, 0 or 1, representing the final state.</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    state <span class="op">=</span> np.random.randint(<span class="dv">2</span>)  <span class="co"># randomly initialize a state</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> state <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> np.random.random() <span class="op">&lt;</span> P[<span class="dv">0</span>,<span class="dv">0</span>]:</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>                state <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>                state <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> np.random.random() <span class="op">&lt;</span> P[<span class="dv">1</span>,<span class="dv">0</span>]:</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>                state <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>                state <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> state</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">0.7</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>beta <span class="op">=</span> <span class="fl">0.4</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>sample_size <span class="op">=</span> <span class="dv">10000</span>  <span class="co"># For each fixed number of steps, use 10000 simulations to determine the probabilities</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>n_max <span class="op">=</span> <span class="dv">100</span>  <span class="co"># Consider 1, 2, 3, up until 100 steps</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>P <span class="op">=</span> np.array([[alpha, <span class="dv">1</span><span class="op">-</span>alpha], [beta, <span class="dv">1</span><span class="op">-</span>beta]])</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> np.zeros((n_max,<span class="dv">2</span>))  <span class="co"># Store all the probabilities corresponding to all numbers of steps</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, n_max<span class="op">+</span><span class="dv">1</span>):</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(sample_size):</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> simulate_rain(P, n) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>            p[n<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>            p[n<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    p[n<span class="op">-</span><span class="dv">1</span>,:] <span class="op">/=</span> p[n<span class="op">-</span><span class="dv">1</span>,:].<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="ea5d47ab" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure() </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>plt.plot(np.arange(<span class="dv">1</span>, n_max<span class="op">+</span><span class="dv">1</span>), p[:, <span class="dv">0</span>], <span class="st">'k-'</span>, label<span class="op">=</span><span class="st">'rain'</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>plt.plot(np.arange(<span class="dv">1</span>, n_max<span class="op">+</span><span class="dv">1</span>), p[:, <span class="dv">1</span>], <span class="st">'r--'</span>, label<span class="op">=</span><span class="st">'no rain'</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Number of steps'</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Probability'</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>plt.show(fig)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Lecture4_files/figure-html/cell-3-output-1.png" width="606" height="429" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="exm-exa2" class="theorem example">
<p><span class="theorem-title"><strong>Example 4.2</strong></span> Consider a three-state Markov chain having a transition probability matrix <span class="math display">\[
P =
\begin{bmatrix}
0.5 &amp; 0.4 &amp; 0.1 \\
0.3 &amp; 0.4 &amp; 0.3 \\
0.2 &amp; 0.3 &amp; 0.5
\end{bmatrix}
\]</span> In the long run, what proportion of time is the process in each of the three states?</p>
</div>
<div id="sol-sol2" class="proof solution">
<p><span class="proof-title"><em>Solution 4.1</em>. </span>The limiting probabilities <span class="math inline">\(\pi_i, i = 0, 1, 2\)</span>, are obtained by solving the set of equations in <a href="#eq-eq4-7" class="quarto-xref">Equation&nbsp;<span>4.1</span></a>. In this case these equations are <span class="math display">\[
\begin{aligned}
\pi_0 &amp;= 0.5\pi_0 + 0.3\pi_1 + 0.2\pi_2 \\
\pi_1 &amp;= 0.4\pi_0 + 0.4\pi_1 + 0.4\pi_2 \\
\pi_2 &amp;= 0.1\pi_0 + 0.3\pi_1 + 0.5\pi_2 \\
\pi_0 + \pi_1 + \pi_2 &amp;= 1
\end{aligned}
\]</span> Solving yields <span class="math display">\[
\pi_0 = \frac{21}{62}, \quad \pi_1 = \frac{23}{62}, \quad \pi_2 = \frac{18}{62}
\]</span></p>
</div>
<div id="exm-exa3" class="theorem example">
<p><span class="theorem-title"><strong>Example 4.3</strong></span> (The Hardyâ€“Weinberg Law and a Markov Chain in Genetics) Consider a large population of individuals, each of whom possesses a particular pair of genes, of which each individual gene is classified as being of type <span class="math inline">\(A\)</span> or type <span class="math inline">\(a\)</span>. Assume that the proportions of individuals whose gene pairs are <span class="math inline">\(AA\)</span>, <span class="math inline">\(aa\)</span>, or <span class="math inline">\(Aa\)</span> are, respectively, <span class="math inline">\(p_0\)</span>, <span class="math inline">\(q_0\)</span>, and <span class="math inline">\(r_0\)</span> (<span class="math inline">\(p_0 + q_0 + r_0 = 1\)</span>). When two individuals mate, each contributes one of his or her genes, chosen at random, to the resultant offspring. Assuming that the mating occurs at random, in that each individual is equally likely to mate with any other individual, we are interested in determining the proportions of individuals in the next generation whose genes are <span class="math inline">\(AA\)</span>, <span class="math inline">\(aa\)</span>, or <span class="math inline">\(Aa\)</span>. Calling these proportions <span class="math inline">\(p\)</span>, <span class="math inline">\(q\)</span>, and <span class="math inline">\(r\)</span>, they are easily obtained by focusing attention on an individual of the next generation and then determining the probabilities for the gene pair of that individual.</p>
<p>To begin, note that randomly choosing a parent and then randomly choosing one of its genes is equivalent to just randomly choosing a gene from the total gene population. By conditioning on the gene pair of the parent, we see that a randomly chosen gene will be type <span class="math inline">\(A\)</span> with probability <span class="math display">\[
P\{A\} = P\{A|AA\}p_0 + P\{A|aa\}q_0 + P\{A|Aa\}r_0 = p_0+r_0/2
\]</span> Similarly, it will be type a with probability <span class="math display">\[
P\{a\} = q_0 + r_0/2
\]</span> Thus, under random mating a randomly chosen member of the next generation will be type <span class="math inline">\(AA\)</span> with probability <span class="math inline">\(p\)</span>, where <span class="math display">\[
p = P\{A\}P\{A\} = (p_0+r_0/2)^2
\]</span> Similarly, the randomly chosen member will be type aa with probability <span class="math display">\[
q = P\{a\}P\{a\} = (q_0+r_0/2)^2
\]</span> and will be type <span class="math inline">\(Aa\)</span> with probability <span class="math display">\[
r = 2P\{A\}P\{a\} = 2(p_0+r_0/2)(q_0+r_0/2)
\]</span> Since each member of the next generation will independently be of each of the three gene types with probabilities <span class="math inline">\(p, q, r\)</span>, it follows that the percentages of the members of the next generation that are of type <span class="math inline">\(AA, aa\)</span>, or <span class="math inline">\(Aa\)</span> are respectively <span class="math inline">\(p\)</span>, <span class="math inline">\(q\)</span>, and <span class="math inline">\(r\)</span>.</p>
<p>If we now consider the total gene pool of this next generation, then <span class="math inline">\(p + r/2\)</span>, the fraction of its genes that are <span class="math inline">\(A\)</span>, will be unchanged from the previous generation. This follows either by arguing that the total gene pool has not changed from generation to generation or by the following simple algebra: <span id="eq-eq4-9"><span class="math display">\[
\begin{aligned}
p+r/2 &amp;= (p_0+r_0/2)^2 +(p_0+r_0/2)(q_0+r_0/2) \\
      &amp;= (p_0+r_0/2)[p_0+r_0/2+q_0+r_0/2] \\
      &amp;= p_0 + r_0/2\quad \text{since } p_0+r_0+q_0 = 1 \\
      &amp;= P\{A\}
\end{aligned}
\tag{4.2}\]</span></span> Thus, the fractions of the gene pool that are <span class="math inline">\(A\)</span> and <span class="math inline">\(a\)</span> are the same as in the initial generation. From this it follows that, under random mating, in all successive generations after the initial one the percentages of the population having gene pairs <span class="math inline">\(AA\)</span>, <span class="math inline">\(aa\)</span>, and <span class="math inline">\(Aa\)</span> will remain fixed at the values <span class="math inline">\(p\)</span>, <span class="math inline">\(q\)</span>, and <span class="math inline">\(r\)</span>. This is known as the <em>Hardyâ€“Weinberg law</em>.</p>
<p>Suppose now that the gene pair population has stabilized in the percentages <span class="math inline">\(p\)</span>, <span class="math inline">\(q\)</span>, <span class="math inline">\(r\)</span>, and let us follow the genetic history of a single individual and her descendants. (For simplicity, assume that each individual has exactly one offspring.) So, for a given individual, let <span class="math inline">\(X_n\)</span> denote the genetic state of her descendant in the <span class="math inline">\(n\)</span>th generation. The transition probability matrix of this Markov chain, namely, <span class="math display">\[
\begin{array}{c c}
&amp; \begin{array}{c c c c c c} AA &amp; &amp; aa &amp; &amp; Aa &amp;\\ \end{array} \\
\begin{array}{c c c}AA \\ aa \\Aa \end{array} &amp;
\left[
\begin{array}{c c c}
p+\frac{r}{2} &amp; 0 &amp; q+\frac{r}{2} \\
0 &amp; q+\frac{r}{2} &amp; p+\frac{r}{2} \\
\frac{p}{2}+\frac{r}{4} &amp; \frac{q}{2}+\frac{r}{4} &amp; \frac{p}{2}+\frac{q}{2} + \frac{r}{2}
\end{array}
\right]
\end{array}
\]</span> is easily verified by conditioning on the state of the randomly chosen mate. It is quite intuitive (why?) that the limiting probabilities for this Markov chain (which also equal the fractions of the individualâ€™s descendants that are in each of the three genetic states) should just be <span class="math inline">\(p\)</span>, <span class="math inline">\(q\)</span>, and <span class="math inline">\(r\)</span>. To verify this we must show that they satisfy <a href="#eq-eq4-7" class="quarto-xref">Equation&nbsp;<span>4.1</span></a>. Because one of the equations in <a href="#eq-eq4-7" class="quarto-xref">Equation&nbsp;<span>4.1</span></a> is redundant, it suffices to show that <span class="math display">\[
\begin{aligned}
p &amp;= p\left(p+\frac{r}{2}\right) + r\left(\frac{p}{2}+\frac{r}{4}\right) = \left(p+\frac{r}{2}\right)^2 \\
q &amp;= q\left(q+\frac{r}{2}\right) + r\left(\frac{q}{2}+\frac{r}{4}\right) = \left(q+\frac{r}{2}\right)^2 \\
p+q+r &amp;= 1
\end{aligned}
\]</span> But this follows from <a href="#eq-eq4-9" class="quarto-xref">Equation&nbsp;<span>4.2</span></a>, and thus the result is established.</p>
</div>
<p>The following result is quite useful.</p>
<div id="prp-prp1" class="theorem proposition">
<p><span class="theorem-title"><strong>Proposition 4.1</strong></span> Let <span class="math inline">\(\{X_n, n \ge 1\}\)</span> be an irreducible Markov chain with stationary probabilities <span class="math inline">\(\pi_j, j \ge 0\)</span>, and let <span class="math inline">\(r\)</span> be a bounded function on the state space. Then, with probability 1, <span class="math display">\[
\lim_{N\rightarrow\infty} \frac{\sum_{n=1}^N r(X_n)}{N} = \sum_{j=0}^\infty r(j)\pi_j
\]</span></p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>If we let <span class="math inline">\(a_j(N)\)</span> be the amount of time the Markov chain spends in state <span class="math inline">\(j\)</span> during time periods <span class="math inline">\(1, \dots, N\)</span>, then <span class="math display">\[
\sum_{n=1}^N r(X_n) = \sum_{j=0}^{\infty} a_j(N)r(j)
\]</span> Since <span class="math inline">\(a_j(N)/N \rightarrow \pi_j\)</span> the result follows from the preceding upon dividing by <span class="math inline">\(N\)</span> and then letting <span class="math inline">\(N\rightarrow\infty\)</span>.</p>
</div>
<p>If we suppose that we earn a reward <span class="math inline">\(r(j)\)</span> whenever the chain is in state <span class="math inline">\(j\)</span>, then <a href="Lecture24.html#prp-prp1" class="quarto-xref">Proposition&nbsp;<span>24.1</span></a> states that our average reward per unit time is <span class="math inline">\(\sum_j r(j)\pi_j\)</span>.</p>
<div id="exm-exa4" class="theorem example">
<p><span class="theorem-title"><strong>Example 4.4</strong></span> For the four state Bonus Malus automobile insurance system specified in Lecture 2, find the average annual premium paid by a policyholder whose yearly number of claims is a Poisson random variable with mean <span class="math inline">\(1/2\)</span>.</p>
</div>
<div id="sol-sol6" class="proof solution">
<p><span class="proof-title"><em>Solution 4.2</em>. </span>With <span class="math inline">\(a_k=e^{-1/2}\frac{(1/2)^k}{k!}\)</span>, we have <span class="math display">\[
a_0 = 0.6065, \quad a_1=0.3033, \quad a_2=0.0758
\]</span> Therefore, the Markov chain of successive states has the following transition probability matrix. <span class="math display">\[
\begin{bmatrix}
0.6065 &amp; 0.3033 &amp; 0.0758 &amp; 0.0144 \\
0.6065 &amp; 0.0000 &amp; 0.3033 &amp; 0.0902 \\
0.0000 &amp; 0.6065 &amp; 0.0000 &amp; 0.3935 \\
0.0000 &amp; 0.0000 &amp; 0.6065 &amp; 0.3935
\end{bmatrix}
\]</span> The stationary probabilities are given as the solution of <span class="math display">\[
\begin{aligned}
\pi_1 &amp;= 0.6065\pi_1 + 0.6065\pi_2 \\
\pi_2 &amp;= 0.3033\pi_1 + 0.6065\pi_3 \\
\pi_3 &amp;= 0.0758\pi_1 + 0.3033\pi_2 + 0.6065\pi_4 \\
\pi_1+\pi_2+\pi_3+\pi_4 &amp;= 1
\end{aligned}
\]</span> Rewriting the first three of these equations gives: <span class="math display">\[
\begin{aligned}
\pi_2 &amp;= \frac{1-0.6065}{0.6065}\pi_1, \\
\pi_3 &amp;= \frac{\pi_2-0.3033\pi_1}{0.6065} \\
\pi_4 &amp;= \frac{\pi_3-0.0758\pi_1-0.3033\pi_2}{0.6065}
\end{aligned}
\]</span> or <span class="math display">\[
\begin{aligned}
\pi_2 &amp;= 0.6488\pi_1, \\
\pi_3 &amp;= 0.5697\pi_1 \\
\pi_4 &amp;= 0.4900\pi_1
\end{aligned}
\]</span> Using that <span class="math inline">\(\sum_{i=1}^4\pi=1\)</span> gives the solution (rounded to four decimal places) <span class="math display">\[
\pi_1 = 0.3692, \quad \pi_2 = 0.2395, \quad \pi_3 = 0.2103, \quad \pi_4 = 0.1809
\]</span> Therefore, the average annual premium paid is <span class="math display">\[
200\pi_1 +250\pi_2 +400\pi_3 +600\pi_4 = 326.375
\]</span></p>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Lecture3.html" class="pagination-link" aria-label="Classification of States for Markov Chains">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Classification of States for Markov Chains</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Lecture5.html" class="pagination-link" aria-label="Some Markov Chains Applications">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Some Markov Chains Applications</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>