<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>2&nbsp; Introduction to Markov Chains – MATH 4792/5792 Probabilistic Modeling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Lecture3.html" rel="next">
<link href="./Lecture1.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Lecture2.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to Markov Chains</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">MATH 4792/5792 Probabilistic Modeling</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Stochastic Processes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture2.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to Markov Chains</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Classification of States for Markov Chains</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Limiting Probabilities for Markov Chains</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Some Markov Chains Applications</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Time Reversible Markov Chains</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Hidden Markov Chains</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">The Exponential Distribution</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Further Properties of the Exponential Distribution</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">The Poisson Process</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Further Properties of Poisson Processes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Conditional Distribution of the Arrival Times</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Introduction to Continuous-Time Markov Chains</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture14.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Introduction to Queueing Theory</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture15.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Exponential Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture16.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Brownian Motion</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture17.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Variations on Brownian Motion and Pricing Stock Options</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture18.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Introduction to Monte Carlo Simulation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture19.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">General Techniques for Simulating Continuous Random Variables</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture20.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Special Techniques for Simulating Continuous Random Variables</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture21.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Simulating from Discrete Distributions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture22.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Simulating Stochastic Processes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture23.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Variance Reduction Techniques-Part I</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture24.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Variance Reduction Techniques-Part II</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lecture25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Variance Reduction Techniques-Part III</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">2.1</span> Introduction</a></li>
  <li><a href="#chapmankolmogorov-equations" id="toc-chapmankolmogorov-equations" class="nav-link" data-scroll-target="#chapmankolmogorov-equations"><span class="header-section-number">2.2</span> Chapman–Kolmogorov Equations</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to Markov Chains</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">2.1</span> Introduction</h2>
<p>Consider a stochastic process <span class="math inline">\(\{X_n, n = 0, 1, 2, \dots\}\)</span> that takes on a finite or countable number of possible values. Unless otherwise mentioned, this set of possible values of the process will be denoted by the set of nonnegative integers <span class="math inline">\(\{0, 1, 2, \dots\}\)</span>. If <span class="math inline">\(X_n = i\)</span>, then the process is said to be in state <span class="math inline">\(i\)</span> at time <span class="math inline">\(n\)</span>. We suppose that whenever the process is in state <span class="math inline">\(i\)</span>, there is a fixed probability <span class="math inline">\(P_{ij}\)</span> that it will next be in state <span class="math inline">\(j\)</span>. That is, we suppose that <span id="eq-4-1"><span class="math display">\[
P\{X_{n+1} = j |X_n=i, X_{n-1}=i_{n-1},\dots,X_1=i_1, X_0=i_0\} = P_{ij}
\tag{2.1}\]</span></span> for all states <span class="math inline">\(i_0, i_1, \dots, i_{n−1}, i, j\)</span> and all <span class="math inline">\(n \ge 0\)</span>. Such a stochastic process is known as a <strong>Markov chain</strong>. <a href="#eq-4-1" class="quarto-xref">Equation&nbsp;<span>2.1</span></a> may be interpreted as stating that, for a Markov chain, the conditional distribution of any future state <span class="math inline">\(X_{n+1}\)</span> given the past states <span class="math inline">\(X_0,X_1, \dots, X_{n−1}\)</span> and the present state <span class="math inline">\(X_n\)</span>, is independent of the past states and depends only on the present state.</p>
<p>The value <span class="math inline">\(P_{ij}\)</span> represents the probability that the process will, when in state <span class="math inline">\(i\)</span>, next make a transition into state <span class="math inline">\(j\)</span>. Since probabilities are nonnegative and since the process must make a transition into some state, we have that <span class="math display">\[
P_{ij} \ge 0,\quad i,j\ge 0; \quad \sum_{j=0}^\infty P_{ij}= 1, \quad i=0,1,\dots
\]</span></p>
<p>Let <span class="math inline">\(P\)</span> denote the matrix of one-step transition probabilities <span class="math inline">\(P_{ij}\)</span> , so that <span class="math display">\[
P =
\begin{bmatrix}
P_{00} &amp; P_{01} &amp; P_{02} &amp; \cdots \\
P_{10} &amp; P_{11} &amp; P_{12} &amp; \cdots \\
\vdots &amp; \vdots &amp; \vdots &amp; \vdots \\
P_{i0} &amp; P_{i1} &amp; P_{i2} &amp; \cdots \\
\vdots &amp; \vdots &amp; \vdots &amp; \vdots
\end{bmatrix}
\]</span></p>
<div id="exm-exa1" class="theorem example">
<p><span class="theorem-title"><strong>Example 2.1</strong></span> (Forecasting the Weather) Suppose that the chance of rain tomorrow depends on previous weather conditions only through whether or not it is raining today and not on past weather conditions. Suppose also that if it rains today, then it will rain tomorrow with probability <span class="math inline">\(\alpha\)</span>; and if it does not rain today, then it will rain tomorrow with probability <span class="math inline">\(\beta\)</span>.</p>
<p>If we say that the process is in state <span class="math inline">\(0\)</span> when it rains and state <span class="math inline">\(1\)</span> when it does not rain, then the preceding is a two-state Markov chain whose transition probabilities are given by <span class="math display">\[
P =
\begin{bmatrix}
\alpha &amp; 1-\alpha \\
\beta &amp; 1-\beta
\end{bmatrix}
\]</span></p>
</div>
<div id="exm-exa2" class="theorem example">
<p><span class="theorem-title"><strong>Example 2.2</strong></span> (A Random Walk Model) A Markov chain whose state space is given by the integers <span class="math inline">\(i = 0,\pm 1,\pm 2, \dots\)</span> is said to be a random walk if, for some number <span class="math inline">\(0&lt;p&lt;1\)</span>, <span class="math display">\[
P_{i,i+1} = p = 1-P_{i,i-1}, \quad i=0,\pm 1, \dots
\]</span> The preceding Markov chain is called a <strong>random walk</strong> for we may think of it as being a model for an individual walking on a straight line who at each point of time either takes one step to the right with probability <span class="math inline">\(p\)</span> or one step to the left with probability <span class="math inline">\(1-p\)</span>.</p>
</div>
<div id="exm-exa3" class="theorem example">
<p><span class="theorem-title"><strong>Example 2.3</strong></span> (A Gambling Model) Consider a gambler who, at each play of the game, either wins <span class="math inline">\(\$1\)</span> with probability <span class="math inline">\(p\)</span> or loses <span class="math inline">\(\$1\)</span> with probability <span class="math inline">\(1 - p\)</span>. If we suppose that our gambler quits playing either when he goes broke or he attains a fortune of <span class="math inline">\(\$N\)</span>, then the gambler’s fortune is a Markov chain having transition probabilities <span class="math display">\[
\begin{aligned}
P_{i,i+1} &amp;= p = 1-P_{i,i-1}, \quad i=1,2,\dots,N-1 \\
P_{00} &amp;= P_{NN} = 1
\end{aligned}
\]</span> States <span class="math inline">\(0\)</span> and <span class="math inline">\(N\)</span> are called <strong>absorbing states</strong> since once entered they are never left. Note that the preceding is a finite state random walk with absorbing barriers (states <span class="math inline">\(0\)</span> and <span class="math inline">\(N\)</span>).</p>
</div>
<div id="exm-insurance" class="theorem example">
<p><span class="theorem-title"><strong>Example 2.4</strong></span> In most of Europe and Asia annual automobile insurance premiums are determined by use of a Bonus Malus (Latin for Good-Bad) system. Each policyholder is given a positive integer valued state and the annual premium is a function of this state (along, of course, with the type of car being insured and the level of insurance). A policyholder’s state changes from year to year in response to the number of claims made by that policyholder. Because lower numbered states correspond to lower annual premiums, a policyholder’s state will usually decrease if he or she had no claims in the preceding year, and will generally increase if he or she had at least one claim. (Thus, no claims is good and typically results in a decreased premium, while claims are bad and typically result in a higher premium.)</p>
<p>For a given Bonus Malus system, let <span class="math inline">\(s_i(k)\)</span> denote the next state of a policyholder who was in state <span class="math inline">\(i\)</span> in the previous year and who made a total of <span class="math inline">\(k\)</span> claims in that year. If we suppose that the number of yearly claims made by a particular policyholder is a Poisson random variable with parameter <span class="math inline">\(\lambda\)</span>, then the successive states of this policyholder will constitute a Markov chain with transition probabilities <span class="math display">\[
P_{i,j} = \sum_{k: s_i(k)=j}e^{-\lambda}\frac{\lambda^k}{k!},\quad j\ge 0
\]</span></p>
<p>Whereas there are usually many states (20 or so is not atypical), the following table specifies a hypothetical Bonus Malus system having four states.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 11%">
<col style="width: 23%">
<col style="width: 14%">
<col style="width: 13%">
<col style="width: 14%">
<col style="width: 23%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th></th>
<th>Next</th>
<th>state</th>
<th>if</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>State</td>
<td>Annual Premium</td>
<td>0 claims</td>
<td>1 claim</td>
<td>2 claims</td>
<td><span class="math inline">\(\ge 3\)</span> claims</td>
</tr>
<tr class="even">
<td>——–</td>
<td>—————-</td>
<td>———-</td>
<td>———</td>
<td>———-</td>
<td>—————-</td>
</tr>
<tr class="odd">
<td>1</td>
<td>200</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>4</td>
</tr>
<tr class="even">
<td>2</td>
<td>250</td>
<td>1</td>
<td>3</td>
<td>4</td>
<td>4</td>
</tr>
<tr class="odd">
<td>3</td>
<td>400</td>
<td>2</td>
<td>4</td>
<td>4</td>
<td>4</td>
</tr>
<tr class="even">
<td>4</td>
<td>600</td>
<td>3</td>
<td>4</td>
<td>4</td>
<td>4</td>
</tr>
</tbody>
</table>
<p>Thus, for instance, the table indicates that <span class="math inline">\(s_2(0) = 1\)</span>; <span class="math inline">\(s_2(1) = 3\)</span>; <span class="math inline">\(s_2(k) = 4\)</span>, <span class="math inline">\(k \ge 2\)</span>. Consider a policyholder whose annual number of claims is a Poisson random variable with parameter <span class="math inline">\(\lambda\)</span>. If <span class="math inline">\(a_k\)</span> is the probability that such a policyholder makes <span class="math inline">\(k\)</span> claims in a year, then <span class="math display">\[
a_k = e^{-\lambda}\frac{\lambda^k}{k!}, \quad k\ge 0
\]</span> For the Bonus Malus system specified in the preceding table, the transition probability matrix of the successive states of this policyholder is <span class="math display">\[
P =
\begin{bmatrix}
a_0 &amp; a_1 &amp; a_2 &amp; 1-a_0-a_1-a_2 \\
a_0 &amp; 0 &amp; a_1 &amp; 1-a_0-a_1 \\
0 &amp; a_0 &amp; 0 &amp; 1-a_0 \\
0 &amp; 0 &amp; a_0 &amp; 1-a_0 \\
\end{bmatrix}
\]</span></p>
</div>
</section>
<section id="chapmankolmogorov-equations" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="chapmankolmogorov-equations"><span class="header-section-number">2.2</span> Chapman–Kolmogorov Equations</h2>
<p>We have already defined the one-step transition probabilities <span class="math inline">\(P_{ij}\)</span> . We now define the <span class="math inline">\(n\)</span>-step transition probabilities <span class="math inline">\(P^n_{ij}\)</span> to be the probability that a process in state <span class="math inline">\(i\)</span> will be in state <span class="math inline">\(j\)</span> after <span class="math inline">\(n\)</span> additional transitions. That is, <span class="math display">\[
P^n_{ij} = P\{X_{n+k}=j | X_k=i\}, \quad n\ge 0, i,j\ge 0
\]</span> Of course <span class="math inline">\(P^1_{ij} = P_{ij}\)</span>. The <strong>Chapman–Kolmogorov equations</strong> provide a method for computing these <span class="math inline">\(n\)</span>-step transition probabilities. These equations are <span id="eq-4-2"><span class="math display">\[
P^{n+m}_{ij} = \sum_{k=0}^\infty P^n_{ik} P^m_{kj} \quad \text{for all }n, m\ge 0, \text{ all }i,j
\tag{2.2}\]</span></span> and are most easily understood by noting that <span class="math inline">\(P^n_{ik} P^m_{kj}\)</span> represents the probability that starting in <span class="math inline">\(i\)</span> the process will go to state <span class="math inline">\(j\)</span> in <span class="math inline">\(n + m\)</span> transitions through a path which takes it into state <span class="math inline">\(k\)</span> at the <span class="math inline">\(n\)</span>th transition. Hence, summing over all intermediate states <span class="math inline">\(k\)</span> yields the probability that the process will be in state <span class="math inline">\(j\)</span> after <span class="math inline">\(n+m\)</span> transitions. Formally, we have <span class="math display">\[
\begin{aligned}
P^{n+m}_{ij}
&amp;= \sum_{k=0}^\infty P\{X_{n+m} = j| X_n = k, X_0 = i\} P\{X_{n} = k | X_0 = i\} = \sum_{k=0}^\infty P^n_{ik} P^m_{kj}
\end{aligned}
\]</span></p>
<p>If we let <span class="math inline">\(P^{(n)}\)</span> denote the matrix of <span class="math inline">\(n\)</span>-step transition probabilities <span class="math inline">\(P^n_{ij}\)</span> , then <a href="#eq-4-2" class="quarto-xref">Equation&nbsp;<span>2.2</span></a> asserts that <span class="math display">\[
P^{(n+m)} = P^{(n)}\cdot P^{(m)}
\]</span> where the dot represents matrix multiplication. Hence, in particular, <span class="math display">\[
P^{(2)} = P^{(1+1)} = P\cdot P = P^{2}
\]</span> and by induction <span class="math display">\[
P^{(n)} = P^{(n-1+1)} = P^{n-1}\cdot P =  P^{n}
\]</span> That is, the <span class="math inline">\(n\)</span>-step transition matrix may be obtained by multiplying the matrix <span class="math inline">\(P\)</span> by itself <span class="math inline">\(n\)</span> times.</p>
<div id="exm-exa4" class="theorem example">
<p><span class="theorem-title"><strong>Example 2.5</strong></span> Consider <a href="Lecture25.html#exm-exa1" class="quarto-xref">Example&nbsp;<span>25.1</span></a> in which the weather is considered as a two-state Markov chain. If <span class="math inline">\(\alpha = 0.7\)</span> and <span class="math inline">\(\beta = 0.4\)</span>, then calculate the probability that it will rain four days from today given that it is raining today.</p>
</div>
<div id="sol-exa4" class="proof solution">
<p><span class="proof-title"><em>Solution 2.1</em>. </span>The one-step transition probability matrix is given by</p>
</div>
<p><span class="math display">\[
P =
\begin{bmatrix}
0.7 &amp; 0.3 \\
0.4 &amp; 0.6
\end{bmatrix}
\]</span> Hence, <span class="math display">\[
P^{(2)} = P^2 =
\begin{bmatrix}
0.7 &amp; 0.3 \\
0.4 &amp; 0.6
\end{bmatrix} \cdot
\begin{bmatrix}
0.7 &amp; 0.3 \\
0.4 &amp; 0.6
\end{bmatrix} =
\begin{bmatrix}
0.61 &amp; 0.39 \\
0.52 &amp; 0.48
\end{bmatrix}
\]</span> <span class="math display">\[
P^{(4)} = (P^2)^2 =
\begin{bmatrix}
0.61 &amp; 0.39 \\
0.52 &amp; 0.48
\end{bmatrix} \cdot
\begin{bmatrix}
0.61 &amp; 0.39 \\
0.52 &amp; 0.48
\end{bmatrix} =
\begin{bmatrix}
0.5749 &amp; 0.4251 \\
0.5668 &amp; 0.4332
\end{bmatrix}
\]</span> and the desired probability <span class="math inline">\(P^4_{00}\)</span> equals <span class="math inline">\(0.5749\)</span>.</p>
<p>So far, all of the probabilities we have considered are conditional probabilities. For instance, <span class="math inline">\(P^n_{ij}\)</span> is the probability that the state at time <span class="math inline">\(n\)</span> is <span class="math inline">\(j\)</span> given that the initial state at time <span class="math inline">\(0\)</span> is <span class="math inline">\(i\)</span>. If the unconditional distribution of the state at time <span class="math inline">\(n\)</span> is desired, it is necessary to specify the probability distribution of the initial state. Let us denote this by <span class="math display">\[
\alpha_i \equiv P\{X_0 = i\}, \quad i\ge 0, \sum_{i=0}^\infty \, \alpha_i=1
\]</span></p>
<p>All unconditional probabilities may be computed by conditioning on the initial state. That is, <span class="math display">\[
P\{X_n=j\} = \sum_{i=0}^\infty P\{X_n=j|X_0=i\} P\{X_0=i\} = \sum_{i=0}^\infty P^n_{ij}\alpha_i
\]</span> For instance, if <span class="math inline">\(\alpha_0 = 0.4\)</span>, <span class="math inline">\(\alpha_1 = 0.6\)</span>, in <a href="Lecture25.html#exm-exa4" class="quarto-xref">Example&nbsp;<span>25.4</span></a>, then the (unconditional) probability that it will rain four days after we begin keeping weather records is <span class="math display">\[
P\{X_4=0\} = 0.4 P^4_{00} + 0.6 P^4_{10} = (0.4)(0.5749)+ (0.6)(0.5668) = 0.5700
\]</span></p>
<p>Suppose now that you want to determine the probability that a Markov chain enters any of a specified set of states <span class="math inline">\(\mathcal{A}\)</span> by time <span class="math inline">\(n\)</span>. One way to accomplish this is to reset the transition probabilities out of states in <span class="math inline">\(\mathcal{A}\)</span> to <span class="math display">\[
P\{X_{m+1}=j | X_m=i\} =
\begin{cases}
1, &amp; \text{if } i\in \mathcal{A}, j=i \\
0, &amp; \text{if } i\in \mathcal{A}, j\ne i \\
\end{cases}
\]</span></p>
<p>That is, transform all states in <span class="math inline">\(\mathcal{A}\)</span> into absorbing states which once entered can never be left. Because the original and transformed Markov chain follows identical probabilities until a state in <span class="math inline">\(\mathcal{A}\)</span> is entered, it follows that the probability the original Markov chain enters a state in <span class="math inline">\(\mathcal{A}\)</span> by time <span class="math inline">\(n\)</span> is equal to the probability that the transformed Markov chain is in one of the states of <span class="math inline">\(\mathcal{A}\)</span> at time <span class="math inline">\(n\)</span>.</p>
<div id="exm-exa5" class="theorem example">
<p><span class="theorem-title"><strong>Example 2.6</strong></span> A pensioner receives <span class="math inline">\(2\)</span> (thousand dollars) at the beginning of each month. The amount of money he needs to spend during a month is independent of the amount he has and is equal to <span class="math inline">\(i\)</span> with probability <span class="math inline">\(P_i, i = 1, 2, 3, 4, \sum_{i=1}^4 P_i = 1\)</span>. If the pensioner has more than <span class="math inline">\(3\)</span> at the end of a month, he gives the amount greater than <span class="math inline">\(3\)</span> to his son. If, after receiving his payment at the beginning of a month, the pensioner has a capital of <span class="math inline">\(5\)</span>, what is the probability that his capital is ever <span class="math inline">\(1\)</span> or less at any time within the following four months?</p>
</div>
<div id="sol-exa5" class="proof solution">
<p><span class="proof-title"><em>Solution 2.2</em>. </span>To find the desired probability, we consider a Markov chain with the state equal to the amount the pensioner has at the end of a month. Because we are interested in whether this amount ever falls as low as <span class="math inline">\(1\)</span>, we will let <span class="math inline">\(1\)</span> mean that the pensioner’s end-of-month fortune has ever been less than or equal to <span class="math inline">\(1\)</span>. Because the pensioner will give any end-of-month amount greater than <span class="math inline">\(3\)</span> to his son, we need only consider the Markov chain with states <span class="math inline">\(1, 2, 3\)</span> and transition probability matrix <span class="math inline">\(Q = [Q_{i,j}]\)</span> given by <span class="math display">\[
\begin{bmatrix}
1 &amp; 0 &amp; 0 \\
P_3+P_4 &amp; P_2 &amp; P_1 \\
P_4 &amp; P_3 &amp; P_1+P_2
\end{bmatrix}
\]</span> To understand the preceding, consider <span class="math inline">\(Q_{2,1}\)</span>, the probability that a month that ends with the pensioner having the amount <span class="math inline">\(2\)</span> will be followed by a month that ends with the pensioner having less than or equal to <span class="math inline">\(1\)</span>. Because the pensioner will begin the new month with the amount <span class="math inline">\(2+2 = 4\)</span>, his ending capital will be less than or equal to <span class="math inline">\(1\)</span> if his expenses are either <span class="math inline">\(3\)</span> or <span class="math inline">\(4\)</span>. Thus, <span class="math inline">\(Q_{2,1} = P_3 + P_4\)</span>. The other transition probabilities are similarly explained.</p>
<p>Suppose now that <span class="math inline">\(P_i=1/4, i=1,2,3,4\)</span>. The transition probability matrix is <span class="math display">\[
\begin{bmatrix}
1 &amp; 0 &amp; 0 \\
1/2 &amp; 1/4 &amp; 1/4 \\
1/4 &amp; 1/4 &amp; 1/2
\end{bmatrix}
\]</span> Squaring this matrix and then squaring the result gives the matrix <span class="math display">\[
\begin{bmatrix}
1 &amp; 0 &amp; 0 \\
\frac{222}{256} &amp; \frac{13}{256} &amp; \frac{21}{256} \\
\frac{201}{256} &amp; \frac{21}{256} &amp; \frac{34}{256} \\
\end{bmatrix}
\]</span> Because the pensioner’s initial end of month capital was <span class="math inline">\(3\)</span>, the desired answer is <span class="math inline">\(Q^4_{3,1} = \frac{201}{256}\)</span>.</p>
</div>
<p>Let <span class="math inline">\(\{X_n,n\ge 0\}\)</span> be a Markov chain with transition probabilities <span class="math inline">\(P_{i,j}\)</span>. If we let <span class="math inline">\(Q_{i,j}\)</span> denote the transition probabilities that transform all states in <span class="math inline">\(\mathcal{A}\)</span> into absorbing states, then <span class="math display">\[
Q_{i,j} =
\begin{cases}
1, &amp; \text{if } i\in\mathcal{A}, j=i \\
0, &amp; \text{if } i\in\mathcal{A}, j\ne i \\
P_{i,j}, &amp; \text{otherwise}
\end{cases}
\]</span> For <span class="math inline">\(i,j\notin \mathcal{A}\)</span>, the <span class="math inline">\(n\)</span> stage transition probability <span class="math inline">\(Q^n_{i,j}\)</span> represents the probability that the original chain, starting in state <span class="math inline">\(i\)</span>, will be in state <span class="math inline">\(j\)</span> at time <span class="math inline">\(n\)</span> without ever having entered any of the states in <span class="math inline">\(\mathcal{A}\)</span> . For instance, in <a href="Lecture13.html#exm-exa5" class="quarto-xref">Example&nbsp;<span>13.5</span></a>, starting with <span class="math inline">\(5\)</span> at the beginning of January, the probability that the pensioner’s capital is <span class="math inline">\(4\)</span> at the beginning of May without ever having been less than or equal to <span class="math inline">\(1\)</span> in that time is <span class="math inline">\(Q^4_{3,2} = 21/256\)</span>.</p>
<p>We can also compute the conditional probability of <span class="math inline">\(X_n\)</span> given that the chain starts in state <span class="math inline">\(i\)</span> and has not entered any state in <span class="math inline">\(\mathcal{A}\)</span> by time <span class="math inline">\(n\)</span>, as follows. For <span class="math inline">\(i, j \notin \mathcal{A}\)</span>, <span class="math display">\[
\begin{aligned}
P\{X_n=j | X_0=i, X_k\notin\mathcal{A}, k=1,\dots,n\} &amp;= \frac{P\{X_n=j, X_k\notin\mathcal{A}, k=1,\dots,n | X_0=i\}}{P\{X_k\notin\mathcal{A}, k=1,\dots,n | X_0=i\}} \\
&amp;= \frac{Q^n_{i,j}}{\sum_{r\notin\mathcal{A}}Q^n_{i,r}}
\end{aligned}
\]</span></p>
<p>Now we use Python to numerically compute the probability analytically calculated in <a href="Lecture13.html#exm-exa5" class="quarto-xref">Example&nbsp;<span>13.5</span></a>.</p>
<div id="9e3136cd" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> prob_1_or_less(P, sample_size):</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Compute the probability that the capital is ever 1 or less at any time </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">    within the following four months</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">    input:</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">    P: a 1d numpy array of shape (4), the probability of spending i, </span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">    i=1,2,3,4</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">    sample_size: int, sample size for the simulation, i.e., how many </span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">    experiments are performed</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">    output:</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co">    prob, float, the probability that the capital is ever 1 or less </span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co">    at any time within the following four months</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    count <span class="op">=</span> <span class="dv">0</span>  <span class="co"># count the number of times when the capital falls at or below 1</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    P_cumsum <span class="op">=</span> np.cumsum(P)  <span class="co"># cumulative sum of probabilities to simulate expenditures</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(sample_size):</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># initial capital. Use 3 instead of 5, since we add 2 at the beginning of each month</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>        capital <span class="op">=</span> <span class="fl">3.0</span>  </span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>):  <span class="co"># simulate 4 months</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>            capital <span class="op">+=</span> <span class="fl">2.0</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>            expenditure <span class="op">=</span> np.where((np.random.random()<span class="op">&lt;</span>P_cumsum) <span class="op">==</span> <span class="dv">1</span>)[<span class="dv">0</span>][<span class="dv">0</span>] <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>            capital <span class="op">-=</span> expenditure</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> capital <span class="op">&lt;=</span> <span class="fl">1.0</span>:  <span class="co"># Check if capital is &lt;= 1, if so, get out of the inner loop</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>                count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> capital <span class="op">&gt;</span> <span class="dv">3</span>:</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>                capital <span class="op">=</span> <span class="fl">3.0</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    prob <span class="op">=</span> count <span class="op">/</span> sample_size</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> prob</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="0ab79de5" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>P <span class="op">=</span> np.array([<span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>])</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>sample_size <span class="op">=</span> <span class="dv">100000</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>prob <span class="op">=</span> prob_1_or_less(P, sample_size)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Computed probability is '</span>, prob, <span class="st">'and the theoretical probability is '</span>, <span class="dv">201</span><span class="op">/</span><span class="dv">256</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Computed probability is  0.78755 and the theoretical probability is  0.78515625</code></pre>
</div>
</div>
<p>The numerical result verifies our theoretical result.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Lecture1.html" class="pagination-link" aria-label="Stochastic Processes">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Stochastic Processes</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Lecture3.html" class="pagination-link" aria-label="Classification of States for Markov Chains">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Classification of States for Markov Chains</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>